"0","# Create year variable from date."
"0","tour_data <- tour_data %>%"
"0","  mutate(year = year(date))"
"0",""
"0","# Create date variable date_1900 with all dates in same year, 1900 arbitrarily. "
"0","tour_data <- tour_data %>%"
"0","  mutate(date_1900 = make_date(year = 1900L, month = month(date), day = day(date)))"
"0",""
"0","# Create variable tour_day to be day of tour, and section_number to be section of tour (ie if there are more than one stage or substage on a day they are given a different sectionnumber but the same tour_day)."
"0","tour_data <- tour_data %>%"
"0","  arrange(date) %>%"
"0","  group_by(year) %>%"
"0","  mutate(tour_day = lubridate::time_length(interval(min(date), date), ""day""),"
"0","         counter = if_else(terrain_group == ""Rest day"", 0, 1),"
"0","         section_number = if_else(terrain_group == ""Rest day"", -1, cumsum(counter))) %>%"
"0","  select(-counter) %>%"
"0","  ungroup()"
"0",""
"0","tour_start_loc <- tour_data %>%"
"0","  select(-end_lat,"
"0","         -end_long,"
"0","         -end_place,"
"0","         -end_country,"
"0","         -end_gnid,"
"0","         -end_elev) %>%"
"0","  rename("
"0","    place = ""start_place"","
"0","    country = ""start_country"","
"0","    lat = ""start_lat"","
"0","    long = ""start_long"","
"0","    elev = ""start_elev"","
"0","    gnid = ""start_gnid"""
"0","  ) %>%"
"0","  mutate(position = ""start"")"
"0",""
"0","tour_end_loc <- tour_data %>%"
"0","  select(-start_lat,"
"0","         -start_long,"
"0","         -start_place,"
"0","         -start_country,"
"0","         -start_gnid,"
"0","         -start_elev) %>%"
"0","  rename("
"0","    place = ""end_place"","
"0","    country = ""end_country"","
"0","    lat = ""end_lat"","
"0","    long = ""end_long"","
"0","    elev = ""end_elev"","
"0","    gnid = ""end_gnid"""
"0","  ) %>%"
"0","  mutate(position = ""end"")"
"0",""
"0","tour_all_loc <- dplyr::bind_rows(tour_start_loc, tour_end_loc) %>%"
"0","  arrange(date, position)"
"0",""
"0","rm(tour_start_loc, tour_end_loc)"
"0",""
"0","tour_all_loc[1:20, ]"
